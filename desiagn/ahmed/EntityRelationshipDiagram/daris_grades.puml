@startuml
hide circle
skinparam linetype ortho

' Color Customization
skinparam {
    BackgroundColor white
    ArrowColor #4C5FD5
    
    ' Entity / Class Diagram specific
    ClassBackgroundColor white
    ClassBorderColor #4C5FD5
    ClassHeaderBackgroundColor #5AC8FA
    
    ' Entity styling (PlantUML treats entities similar to classes often, but explicit keywords align with class styling)
    ' If explicit entity styling is needed:
    EntityBackgroundColor white
    EntityBorderColor #4C5FD5
}


entity "**grade_categories**" as grade_categories {
  *id : bigint unsigned NOT NULL AUTO_INCREMENT 
  courseid : bigint unsigned NOT NULL COMMENT 'The course this grade category is part of' (FK)
  parent : bigint unsigned DEFAULT NULL COMMENT 'Categories can be hierarchical' (FK)
  depth : int NOT NULL DEFAULT '0' COMMENT 'How many parents does this category have?' 
  path : varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'shows the path as /1/2/3 (like course_categories)' 
  fullname : varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT 'The name of this grade category' 
  aggregation : int NOT NULL DEFAULT '0' COMMENT 'A constant pointing to one of the predefined aggregation strategies (none 
  keephigh : int NOT NULL DEFAULT '0' COMMENT 'Keep only the X highest items' 
  droplow : int NOT NULL DEFAULT '0' COMMENT 'Drop the X lowest items' 
  aggregateonlygraded : tinyint(1) NOT NULL DEFAULT '0' COMMENT 'aggregate only graded activities' 
  aggregateoutcomes : tinyint(1) NOT NULL DEFAULT '0' COMMENT 'Aggregate outcomes' 
  timecreated : int NOT NULL 
  timemodified : int NOT NULL 
  hidden : int NOT NULL DEFAULT '0' 
}

entity "**grade_categories_history**" as grade_categories_history {
  *id : bigint unsigned NOT NULL AUTO_INCREMENT 
  action : int NOT NULL DEFAULT '0' COMMENT 'created/modified/deleted constants' 
  oldid : bigint unsigned NOT NULL (FK)
  source : varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'What caused the modification? manual/module/import/...' 
  timemodified : int DEFAULT NULL COMMENT 'The last time this grade_item was modified' 
  loggeduser : bigint unsigned DEFAULT NULL COMMENT 'the userid of the person who last modified this outcome' (FK)
  courseid : bigint unsigned NOT NULL COMMENT 'The course this grade category is part of' (FK)
  parent : bigint unsigned DEFAULT NULL COMMENT 'Categories can be hierarchical' (FK)
  depth : int NOT NULL DEFAULT '0' COMMENT 'How many parents does this category have?' 
  path : varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'shows the path as /1/2/3 (like course_categories)' 
  fullname : varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT 'The name of this grade category' 
  aggregation : int NOT NULL DEFAULT '0' COMMENT 'A constant pointing to one of the predefined aggregation strategies (none 
  keephigh : int NOT NULL DEFAULT '0' COMMENT 'Keep only the X highest items' 
  droplow : int NOT NULL DEFAULT '0' COMMENT 'Drop the X lowest items' 
  aggregateonlygraded : tinyint(1) NOT NULL DEFAULT '0' COMMENT 'aggregate only graded items' 
  aggregateoutcomes : tinyint(1) NOT NULL DEFAULT '0' COMMENT 'Aggregate outcomes' 
  aggregatesubcats : tinyint(1) NOT NULL DEFAULT '0' COMMENT 'This setting was removed from grade_categories. It is kept here only to preserve history.' 
  hidden : int NOT NULL DEFAULT '0' 
}

entity "**grade_grades**" as grade_grades {
  *id : bigint unsigned NOT NULL AUTO_INCREMENT 
  itemid : bigint unsigned NOT NULL COMMENT 'The item this grade belongs to' (FK)
  userid : bigint unsigned NOT NULL COMMENT 'The user who this grade is for' (FK)
  rawgrade : decimal(10 
  rawgrademax : decimal(10 
  rawgrademin : decimal(10 
  rawscaleid : bigint unsigned DEFAULT NULL COMMENT 'If this grade is based on a scale (FK)
  usermodified : bigint unsigned DEFAULT NULL COMMENT 'the userid of the person who last modified this grade' (FK)
  finalgrade : decimal(10 
  hidden : int NOT NULL DEFAULT '0' COMMENT 'show 0 
  locked : int NOT NULL DEFAULT '0' COMMENT 'not locked 0 
  locktime : int NOT NULL DEFAULT '0' COMMENT 'automatic locking of final grade 
  exported : int NOT NULL DEFAULT '0' COMMENT 'date of last grade export 
  overridden : int NOT NULL DEFAULT '0' COMMENT 'indicates grade overridden from gradebook 
  excluded : int NOT NULL DEFAULT '0' COMMENT 'grade excluded from aggregation functions 
  feedback : text COLLATE utf8mb4_unicode_ci COMMENT 'grading feedback' 
  feedbackformat : int NOT NULL DEFAULT '0' COMMENT 'format of feedback text' 
  information : text COLLATE utf8mb4_unicode_ci COMMENT 'optiona information' 
  informationformat : int NOT NULL DEFAULT '0' COMMENT 'format of information text' 
  timecreated : int DEFAULT NULL COMMENT 'the time this grade was first created' 
  timemodified : int DEFAULT NULL COMMENT 'the time this grade was last modified' 
  aggregationstatus : varchar(10) COLLATE utf8mb4_unicode_ci NOT NULL DEFAULT 'unknown' COMMENT 'One of several values describing how this grade_grade was used when calculating the aggregation. Possible values are "unknown" 
  aggregationweight : decimal(10 
}

entity "**grade_grades_history**" as grade_grades_history {
  *id : bigint unsigned NOT NULL AUTO_INCREMENT 
  action : int NOT NULL DEFAULT '0' COMMENT 'created/modified/deleted constants' 
  oldid : bigint unsigned NOT NULL (FK)
  source : varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'What caused the modification? manual/module/import/...' 
  timemodified : int DEFAULT NULL COMMENT 'The last time this grade_item was modified' 
  loggeduser : bigint unsigned DEFAULT NULL COMMENT 'the userid of the person who last modified this outcome' (FK)
  itemid : bigint unsigned NOT NULL COMMENT 'The item this grade belongs to' (FK)
  userid : bigint unsigned NOT NULL COMMENT 'The user who this grade is for' (FK)
  rawgrade : decimal(10 
  rawgrademax : decimal(10 
  rawgrademin : decimal(10 
  rawscaleid : bigint unsigned DEFAULT NULL COMMENT 'If this grade is based on a scale (FK)
  usermodified : bigint unsigned DEFAULT NULL COMMENT 'the userid of the person who last modified this grade' (FK)
  finalgrade : decimal(10 
  hidden : int NOT NULL DEFAULT '0' COMMENT 'show 0 
  locked : int NOT NULL DEFAULT '0' COMMENT 'not locked 0 
  locktime : int NOT NULL DEFAULT '0' COMMENT 'automatic locking of final grade 
  exported : int NOT NULL DEFAULT '0' COMMENT 'date of last grade export 
  overridden : int NOT NULL DEFAULT '0' COMMENT 'indicates grade overridden from gradebook 
  excluded : int NOT NULL DEFAULT '0' COMMENT 'grade excluded from aggregation functions 
  feedback : text COLLATE utf8mb4_unicode_ci COMMENT 'grading feedback' 
  feedbackformat : int NOT NULL DEFAULT '0' COMMENT 'format of feedback text' 
  information : text COLLATE utf8mb4_unicode_ci COMMENT 'optiona information' 
  informationformat : int NOT NULL DEFAULT '0' COMMENT 'format of information text' 
}

entity "**grade_import_newitem**" as grade_import_newitem {
  *id : bigint unsigned NOT NULL AUTO_INCREMENT 
  itemname : varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT 'new grade item name' 
  importcode : int NOT NULL COMMENT 'import batch code for identification' 
  importer : bigint unsigned NOT NULL COMMENT 'user importing the data' (FK)
}

entity "**grade_import_values**" as grade_import_values {
  *id : bigint unsigned NOT NULL AUTO_INCREMENT 
  itemid : bigint unsigned DEFAULT NULL COMMENT 'if set (FK)
  newgradeitem : bigint unsigned DEFAULT NULL COMMENT 'if set (FK)
  userid : bigint unsigned NOT NULL (FK)
  finalgrade : decimal(10 
  feedback : text COLLATE utf8mb4_unicode_ci 
  importcode : int NOT NULL COMMENT 'similar to backup_code 
  importer : bigint unsigned DEFAULT NULL (FK)
  importonlyfeedback : tinyint(1) DEFAULT '0' 
}

entity "**grade_items**" as grade_items {
  *id : bigint unsigned NOT NULL AUTO_INCREMENT 
  courseid : bigint unsigned DEFAULT NULL COMMENT 'The course this item is part of' (FK)
  categoryid : bigint unsigned DEFAULT NULL COMMENT '(optional) the category group this item belongs to' (FK)
  itemname : varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'The name of this item (pushed in by the module)' 
  itemtype : varchar(30) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '''mod'' 
  itemmodule : varchar(30) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '''forum'' 
  iteminstance : int DEFAULT NULL COMMENT 'id of the item module' 
  itemnumber : int DEFAULT NULL COMMENT 'Can be used to distinguish multiple grades for an activity' 
  iteminfo : text COLLATE utf8mb4_unicode_ci COMMENT 'Info and notes about this item XXX' 
  idnumber : varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'Arbitrary idnumber provided by the module responsible' 
  calculation : text COLLATE utf8mb4_unicode_ci COMMENT 'Formula describing how to derive this grade from other items 
  gradetype : smallint NOT NULL DEFAULT '1' COMMENT '0 = none 
  grademax : decimal(10 
  grademin : decimal(10 
  scaleid : bigint unsigned DEFAULT NULL COMMENT 'If this grade is based on a scale (FK)
  outcomeid : bigint unsigned DEFAULT NULL COMMENT 'If this grade is related to an outcome (FK)
  gradepass : decimal(10 
  multfactor : decimal(10 
  plusfactor : decimal(10 
  aggregationcoef : decimal(10 
  aggregationcoef2 : decimal(10 
  sortorder : int NOT NULL DEFAULT '0' COMMENT 'Sorting order of the columns' 
  display : int NOT NULL DEFAULT '0' COMMENT 'Display as real grades 
  decimals : tinyint(1) DEFAULT NULL COMMENT 'Also known as precision 
  hidden : int NOT NULL DEFAULT '0' COMMENT '1 is hidden 
  locked : int NOT NULL DEFAULT '0' COMMENT '1 is locked 
  locktime : int NOT NULL DEFAULT '0' COMMENT 'lock all final grades after this date' 
  needsupdate : int NOT NULL DEFAULT '0' COMMENT 'If this flag is set 
  weightoverride : tinyint(1) NOT NULL DEFAULT '0' 
  timecreated : int DEFAULT NULL COMMENT 'The first time this grade_item was created' 
  timemodified : int DEFAULT NULL COMMENT 'The last time this grade_item was modified' 
}

entity "**grade_items_history**" as grade_items_history {
  *id : bigint unsigned NOT NULL AUTO_INCREMENT 
  action : int NOT NULL DEFAULT '0' COMMENT 'created/modified/deleted constants' 
  oldid : bigint unsigned NOT NULL (FK)
  source : varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'What caused the modification? manual/module/import/...' 
  timemodified : int DEFAULT NULL COMMENT 'The last time this grade_item was modified' 
  loggeduser : bigint unsigned DEFAULT NULL COMMENT 'the userid of the person who last modified this outcome' (FK)
  courseid : bigint unsigned DEFAULT NULL COMMENT 'The course this item is part of' (FK)
  categoryid : bigint unsigned DEFAULT NULL COMMENT '(optional) the category group this item belongs to' (FK)
  itemname : varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'The name of this item (pushed in by the module)' 
  itemtype : varchar(30) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '''mod'' 
  itemmodule : varchar(30) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '''forum'' 
  iteminstance : int DEFAULT NULL COMMENT 'id of the item module' 
  itemnumber : int DEFAULT NULL COMMENT 'Can be used to distinguish multiple grades for an activity' 
  iteminfo : text COLLATE utf8mb4_unicode_ci COMMENT 'Info and notes about this item XXX' 
  idnumber : varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'Arbitrary idnumber provided by the module responsible' 
  calculation : text COLLATE utf8mb4_unicode_ci COMMENT 'Formula describing how to derive this grade from other items 
  gradetype : smallint NOT NULL DEFAULT '1' COMMENT '0 = none 
  grademax : decimal(10 
  grademin : decimal(10 
  scaleid : bigint unsigned DEFAULT NULL COMMENT 'If this grade is based on a scale (FK)
  outcomeid : bigint unsigned DEFAULT NULL COMMENT 'If this grade is related to an outcome (FK)
  gradepass : decimal(10 
  multfactor : decimal(10 
  plusfactor : decimal(10 
  aggregationcoef : decimal(10 
  aggregationcoef2 : decimal(10 
  sortorder : int NOT NULL DEFAULT '0' COMMENT 'Sorting order of the columns' 
  hidden : int NOT NULL DEFAULT '0' COMMENT '1 is hidden 
  locked : int NOT NULL DEFAULT '0' COMMENT '1 is locked 
  locktime : int NOT NULL DEFAULT '0' COMMENT 'lock all final grades after this date' 
  needsupdate : int NOT NULL DEFAULT '0' COMMENT 'If this flag is set 
  display : int NOT NULL DEFAULT '0' 
  decimals : tinyint(1) DEFAULT NULL 
  weightoverride : tinyint(1) NOT NULL DEFAULT '0' 
}

entity "**grade_letters**" as grade_letters {
  *id : bigint unsigned NOT NULL AUTO_INCREMENT 
  contextid : int NOT NULL COMMENT 'What contextid does this letter apply to (for now these will always be courses 
  lowerboundary : decimal(10 
  letter : varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT 'The display value of the letter. Can be any character or string of characters (OK 
}

entity "**grade_outcomes**" as grade_outcomes {
  *id : bigint unsigned NOT NULL AUTO_INCREMENT 
  courseid : bigint unsigned DEFAULT NULL COMMENT 'Mostly these are defined site wide ie NULL' (FK)
  shortname : varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT 'The short name or code for this outcome statement' 
  fullname : text COLLATE utf8mb4_unicode_ci NOT NULL COMMENT 'The full description of the outcome (usually 1 sentence)' 
  scaleid : bigint unsigned DEFAULT NULL COMMENT 'The recommended scale for this outcome.' (FK)
  description : text COLLATE utf8mb4_unicode_ci COMMENT 'outcome description' 
  descriptionformat : tinyint NOT NULL DEFAULT '0' 
  timecreated : int DEFAULT NULL COMMENT 'the time this outcome was first created' 
  timemodified : int DEFAULT NULL COMMENT 'the time this outcome was last updated' 
  usermodified : bigint unsigned DEFAULT NULL COMMENT 'the userid of the person who last modified this outcome' (FK)
}

entity "**grade_outcomes_courses**" as grade_outcomes_courses {
  *id : bigint unsigned NOT NULL AUTO_INCREMENT 
  courseid : bigint unsigned NOT NULL COMMENT 'id of the course' (FK)
  outcomeid : bigint unsigned NOT NULL COMMENT 'id of the outcome' (FK)
}

entity "**grade_outcomes_history**" as grade_outcomes_history {
  *id : bigint unsigned NOT NULL AUTO_INCREMENT 
  action : int NOT NULL DEFAULT '0' COMMENT 'created/modified/deleted constants' 
  oldid : bigint unsigned NOT NULL (FK)
  source : varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'What caused the modification? manual/module/import/...' 
  timemodified : int DEFAULT NULL COMMENT 'The last time this grade_item was modified' 
  loggeduser : bigint unsigned DEFAULT NULL COMMENT 'the userid of the person who last modified this outcome' (FK)
  courseid : bigint unsigned DEFAULT NULL COMMENT 'Mostly these are defined site wide ie NULL' (FK)
  shortname : varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT 'The short name or code for this outcome statement' 
  fullname : text COLLATE utf8mb4_unicode_ci NOT NULL COMMENT 'The full description of the outcome (usually 1 sentence)' 
  scaleid : bigint unsigned DEFAULT NULL COMMENT 'The recommended scale for this outcome.' (FK)
  description : text COLLATE utf8mb4_unicode_ci COMMENT 'Outcome description' 
  descriptionformat : tinyint NOT NULL DEFAULT '0' 
}

entity "**grade_settings**" as grade_settings {
  *id : bigint unsigned NOT NULL AUTO_INCREMENT 
  courseid : bigint unsigned NOT NULL (FK)
  name : varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL 
  value : text COLLATE utf8mb4_unicode_ci 
}

entity "**gradepenalty_duedate_rule**" as gradepenalty_duedate_rule {
  *id : bigint unsigned NOT NULL AUTO_INCREMENT 
  contextid : bigint NOT NULL 
  sortorder : bigint NOT NULL DEFAULT '0' 
  overdueby : bigint NOT NULL 
  penalty : double NOT NULL 
  usermodified : bigint NOT NULL DEFAULT '0' 
  timecreated : bigint NOT NULL DEFAULT '0' 
  timemodified : bigint NOT NULL DEFAULT '0' 
}

entity "**course**" as course <<External>> {
  --
}

entity "**scale**" as scale <<External>> {
  --
}

entity "**users**" as users <<External>> {
  --
}

grade_categories }|--|| course
grade_categories }|--|| grade_categories
grade_categories_history }|--|| course
grade_categories_history }|--|| users
grade_categories_history }|--|| grade_categories
grade_categories_history }|--|| grade_categories
grade_grades }|--|| grade_items
grade_grades }|--|| scale
grade_grades }|--|| users
grade_grades }|--|| users
grade_grades_history }|--|| grade_items
grade_grades_history }|--|| users
grade_grades_history }|--|| grade_grades
grade_grades_history }|--|| scale
grade_grades_history }|--|| users
grade_grades_history }|--|| users
grade_import_newitem }|--|| users
grade_import_values }|--|| users
grade_import_values }|--|| grade_items
grade_import_values }|--|| grade_import_newitem
grade_import_values }|--|| users
grade_items }|--|| grade_categories
grade_items }|--|| course
grade_items }|--|| grade_outcomes
grade_items }|--|| scale
grade_items_history }|--|| grade_categories
grade_items_history }|--|| course
grade_items_history }|--|| users
grade_items_history }|--|| grade_items
grade_items_history }|--|| grade_outcomes
grade_items_history }|--|| scale
grade_outcomes }|--|| course
grade_outcomes }|--|| scale
grade_outcomes }|--|| users
grade_outcomes_courses }|--|| course
grade_outcomes_courses }|--|| grade_outcomes
grade_outcomes_history }|--|| course
grade_outcomes_history }|--|| users
grade_outcomes_history }|--|| grade_outcomes
grade_outcomes_history }|--|| scale
grade_settings }|--|| course
@enduml
