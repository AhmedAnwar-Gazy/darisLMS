@startuml

' Color Customization
skinparam {
    BackgroundColor white
    ArrowColor #4C5FD5
    
    ' Activity Diagram specific
    ActivityBackgroundColor white
    ActivityBorderColor #4C5FD5
    ActivityStartColor #4C5FD5
    ActivityEndColor #4C5FD5
    ActivityBarColor #4C5FD5
    ActivityDiamondBackgroundColor white
    ActivityDiamondBorderColor #4C5FD5
    
    ' Notes
    NoteBackgroundColor #FBBF24
    NoteBorderColor #FBBF24
    
    ' Error/Warning (custom styles if needed)
    ' Error: #EF4444
}


title Private Messaging & Notifications
skinparam activityBackgroundColor #FFF5EE
skinparam activityBorderColor #A0522D

|Sender|
start
:Navigate to Course Context;
:Click "Message Instructor";
:Compose Message;
:Click "Send";

|Frontend|
:Validate Message Content;
:Send POST /api/messages;

|Backend|
:Check Enrollment Status;
if (Same Course?) then (no)
  :Return 403 Forbidden;
  stop
else (yes)
  :Create Message Record;
endif

|Database|
:INSERT INTO messages\n(sender_id, recipient_id, content);
:UPDATE conversation_last_activity;
-back->

|Backend|
:Trigger MessageSent Event;

|Notification Service|
:Check Recipient Preferences;
if (Online via WebSocket?) then (yes)
  :Send Real-time Push;
else (no)
  :Queue Email Notification;
endif

|Database|
:INSERT INTO notifications\n(type: 'message', user_id);
-back->

|Recipient|
if (Online) then (yes)
  :Receive Browser Notification;
  :Play Sound Alert;
else (no)
  :Receive Email Later;
endif

:Read Message;
:Optionally Reply;
stop
@enduml